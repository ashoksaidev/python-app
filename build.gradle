plugins {
    id 'base'
}

group = 'com.example'
version = '0.1.0'

tasks.register('runApp', Exec) {
    description = 'Run the Python app'
    group = 'application'
    workingDir = project.projectDir
    // Ensure venv activation if present, then run the app
    commandLine('bash', '-lc', '''
      if [ -f ".venv/bin/activate" ]; then . .venv/bin/activate; fi
      python3 src/main/python/app.py
    '''.stripIndent())
}

tasks.register('lintPy', Exec) {
    description = 'Lint Python with flake8 (if installed)'
    group = 'verification'
    commandLine('bash', '-lc', '''
      if [ -f ".venv/bin/activate" ]; then . .venv/bin/activate; fi
      command -v flake8 >/dev/null 2>&1 && flake8 src/ tests/ || echo "flake8 not installed, skipping"
    '''.stripIndent())
}

tasks.register('testPy', Exec) {
    description = 'Run pytest (if installed)'
    group = 'verification'
    commandLine('bash', '-lc', '''
      if [ -f ".venv/bin/activate" ]; then . .venv/bin/activate; fi
      command -v pytest >/dev/null 2>&1 && pytest -q || echo "pytest not installed, skipping"
    '''.stripIndent())
}

tasks.named('build').configure { dependsOn('runApp') }
