name: Deploy

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Retrieve Artifactory Credentials from Vault
        uses: hashicorp/vault-action@v3
        with:
          url: ${{ secrets.VAULT_ADDR }}
          method: approle
          roleId: ${{ secrets.VAULT_ROLE_ID }}
          secretId: ${{ secrets.VAULT_SECRET_ID }}
          exportEnv: true
          secrets: |
            ci/artifactory url=ARTIFACTORY_URL
            ci/artifactory repo_docker=DOCKER_REPO
            ci/artifactory username=ARTIFACTORY_USER
            ci/artifactory password=ARTIFACTORY_PASSWORD

      - name: Deploy application
        run: |
          echo "Deploying with Artifactory credentials..."
          echo "URL: $ARTIFACTORY_URL"
          echo "Repo: $DOCKER_REPO"
          echo "User: $ARTIFACTORY_USER"
